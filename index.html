<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Kare Yoga Online</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg-page: #eef3ff;
      --card-radius: 28px;
      --card-shadow: 0 24px 60px rgba(15, 23, 42, 0.16);
      --text-main: #111827;
      --text-muted: #4b5563;
      --pill-bg: rgba(148, 163, 184, 0.15);
      --pill-text: #4b5563;
      --border-subtle: rgba(148, 163, 184, 0.4);
      --error: #e11d48;

      --warm-primary: #ff8a26;
      --warm-button: #ff8a26;
      --warm-button-shadow: 0 16px 36px rgba(255, 138, 38, 0.48);

      --cold-primary: #2a96ff;
      --cold-button: #2a60ff;
      --cold-button-shadow: 0 16px 36px rgba(42, 96, 255, 0.48);
    }

    * {
      box-sizing: border-box;
    }

    html,
    body {
      margin: 0;
      padding: 0;
      height: 100%;
    }

    body {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at top, #f9fbff 0, var(--bg-page) 45%, #e0ebff 100%);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI",
        sans-serif;
      color: var(--text-main);
      -webkit-font-smoothing: antialiased;
    }

    main.page {
      width: 100%;
      padding: 24px;
      display: flex;
      justify-content: center;
    }

    .card {
      width: min(1120px, 100%);
      max-width: min(1120px, 100% - 32px);
      min-height: 520px;
      background: #ffffff;
      border-radius: var(--card-radius);
      box-shadow: var(--card-shadow);
      display: flex;
      overflow: hidden;
      position: relative;
    }

    @media (min-width: 1440px) {
      .card {
        transform: scale(1.08);
        transform-origin: center top;
      }
    }

    @media (min-width: 1680px) {
      .card {
        transform: scale(1.18);
      }
    }

    @media (min-width: 1920px) {
      .card {
        transform: scale(1.26);
      }
    }

    .hero {
      flex: 0 0 40%;
      position: relative;
      background: #111827;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .hero picture,
    .hero img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .content {
      flex: 0 0 60%;
      padding: 40px 48px 40px 40px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .eyebrow-row {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 12px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: #6b7280;
    }

    .pill {
      padding: 4px 12px;
      border-radius: 999px;
      background: var(--pill-bg);
      border: 1px solid var(--border-subtle);
      font-size: 11px;
      letter-spacing: 0.08em;
      text-transform: none;
      color: var(--pill-text);
      white-space: nowrap;
    }

    h1 {
      font-size: 26px;
      line-height: 1.3;
      margin: 4px 0 8px;
      letter-spacing: -0.02em;
    }

    .lead {
      font-size: 15px;
      line-height: 1.6;
      color: var(--text-muted);
      margin: 0;
    }

    .benefit-list {
      margin: 4px 0 0;
      padding-left: 20px;
      font-size: 14px;
      line-height: 1.6;
      color: var(--text-muted);
    }

    .benefit-list li + li {
      margin-top: 4px;
    }

    .closing {
      font-size: 14px;
      line-height: 1.6;
      color: var(--text-muted);
      margin: 0;
    }

    .closing + .closing {
      margin-top: 4px;
    }

    form {
      margin-top: 6px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .field-label {
      font-size: 13px;
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .required {
      color: var(--error);
    }

    input[type="email"] {
      width: 100%;
      padding: 10px 12px;
      font-size: 14px;
      border-radius: 10px;
      border: 1px solid var(--border-subtle);
      outline: none;
      transition: border-color 0.16s ease, box-shadow 0.16s ease, background-color 0.16s ease;
    }

    input[type="email"]:focus {
      border-color: #4f46e5;
      box-shadow: 0 0 0 1px rgba(79, 70, 229, 0.3);
      background-color: #f9fafb;
    }

    .error-text {
      margin: 0 2px;
      font-size: 12px;
      color: var(--error);
      visibility: hidden;
    }

    .error-text.is-visible {
      visibility: visible;
    }

    button[type="submit"] {
      margin-top: 4px;
      border: none;
      outline: none;
      border-radius: 999px;
      padding: 11px 24px;
      font-size: 14px;
      font-weight: 600;
      color: #ffffff;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      background: var(--cold-button);
      box-shadow: var(--cold-button-shadow);
      transition: transform 0.12s ease, box-shadow 0.12s ease, filter 0.12s ease, background 0.12s ease;
    }

    button[type="submit"]:hover {
      transform: translateY(-1px);
      filter: brightness(1.02);
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.25);
    }

    button[type="submit"]:active {
      transform: translateY(0);
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.18);
    }

    button[type="submit"].is-submitting {
      cursor: default;
      opacity: 0.9;
      transform: none;
      box-shadow: 0 12px 24px rgba(15, 23, 42, 0.15);
    }

    .btn-dots {
      display: none;
      align-items: center;
      gap: 2px;
    }

    .btn-dots span {
      width: 4px;
      height: 4px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.9);
      animation: pulse 1s infinite ease-in-out;
    }

    .btn-dots span:nth-child(2) {
      animation-delay: 0.15s;
    }

    .btn-dots span:nth-child(3) {
      animation-delay: 0.3s;
    }

    @keyframes pulse {
      0%,
      100% {
        transform: translateY(0);
        opacity: 0.5;
      }
      50% {
        transform: translateY(-2px);
        opacity: 1;
      }
    }

    button[type="submit"].is-submitting .btn-dots {
      display: inline-flex;
    }

    button[type="submit"].is-submitting .btn-label {
      opacity: 0.7;
    }

    .privacy-note {
      margin: 4px 0 0;
      font-size: 11px;
      color: #9ca3af;
    }

    .overlay {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 24px;
      background: radial-gradient(circle at top, rgba(15, 23, 42, 0.12), rgba(15, 23, 42, 0.55));
      z-index: 40;
    }

    .overlay.is-visible {
      display: flex;
    }

    .success-card {
      width: min(840px, 100%);
      max-width: min(840px, 100% - 32px);
      background: #ffffff;
      border-radius: 24px;
      box-shadow: 0 30px 80px rgba(15, 23, 42, 0.6);
      display: flex;
      overflow: hidden;
    }

    .success-hero {
      flex: 0 0 38%;
      background: var(--cold-primary);
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .success-hero::before {
      content: "";
      width: 70%;
      height: 70%;
      background: url("product_warm.jpg") center center / cover no-repeat;
      opacity: 0.95;
      border-radius: 999px;
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.45);
    }

    .success-copy {
      flex: 0 0 62%;
      padding: 32px 40px 32px 32px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .success-copy h2 {
      font-size: 22px;
      margin: 0;
      letter-spacing: -0.02em;
    }

    .success-copy p {
      font-size: 14px;
      margin: 0;
      color: var(--text-muted);
    }

    .eyebrow-row.small {
      font-size: 11px;
      letter-spacing: 0.14em;
    }

    @media (max-width: 900px) {
      main.page {
        padding: 16px;
      }

      .card {
        flex-direction: column;
        max-width: 520px;
      }

      .hero {
        flex-basis: auto;
        height: 220px;
      }

      .content {
        padding: 24px 20px 24px;
      }

      h1 {
        font-size: 22px;
      }

      .lead {
        font-size: 14px;
      }

      .benefit-list {
        font-size: 13px;
      }

      .success-card {
        flex-direction: column;
      }

      .success-hero {
        flex-basis: auto;
        height: 160px;
      }

      .success-hero::before {
        width: 58%;
        height: 58%;
      }

      .success-copy {
        padding: 24px 20px 24px;
      }
    }

    @media (max-width: 480px) {
      .card {
        border-radius: 0;
        max-width: 100%;
        min-height: 100vh;
        box-shadow: none;
      }

      body {
        align-items: stretch;
      }

      main.page {
        padding: 0;
      }

      .hero {
        height: 210px;
      }

      .content {
        padding: 22px 18px 24px;
      }

      .success-card {
        max-width: 480px;
      }
    }
  </style>
</head>
<body>
  <main class="page">
    <section class="card" id="card">
      <div class="hero" id="hero">
        <picture>
          <source id="hero-desktop" media="(min-width: 768px)" srcset="warm.png" />
          <img
            id="hero-mobile"
            src="product_warm.jpg"
            alt="Kare Yoga program"
            loading="lazy"
          />
        </picture>
      </div>

      <div class="content">
        <header class="eyebrow-row">
          <span class="brand">KARE YOGA ONLINE</span>
          <span class="pill" id="session-tag">Online introductory session</span>
        </header>

        <h1 id="headline">
          Find Your Best Fit — Meditation Yoga Online with Kare Yoga
        </h1>

        <p class="lead" id="lead">
          Before beginning any practice, it is important to carefully consider which approach
          aligns most accurately with your needs. Our Meditation Yoga program helps you evaluate
          different methods and identify the option that best suits you—supported by experienced
          instructors who offer clear guidance and thoughtful, reflective feedback.
        </p>

        <ul class="benefit-list" id="benefit-list">
          <!-- bullets injected -->
        </ul>

        <p class="closing" id="closing1"></p>
        <p class="closing" id="closing2"></p>

        <form id="email-form" novalidate>
          <label class="field-label" for="email-input">
            Email<span class="required">*</span>
          </label>
          <input
            type="email"
            id="email-input"
            name="email"
            autocomplete="email"
            inputmode="email"
          />
          <p class="error-text" id="error-text">Please complete this required field.</p>

          <button type="submit" id="submit-btn">
            <span class="btn-label" id="submit-label">Learn More</span>
            <span class="btn-dots" id="submit-dots">
              <span></span><span></span><span></span>
            </span>
          </button>
        </form>

        <p class="privacy-note">
          We’ll only use your email for course-related updates. You can opt out at any time.
        </p>
      </div>
    </section>

    <section class="overlay" id="success-overlay" aria-hidden="true">
      <div class="success-card">
        <div class="success-hero" id="success-hero"></div>
        <div class="success-copy">
          <div class="eyebrow-row small">
            <span>KARE YOGA ONLINE</span>
          </div>
          <h2 id="success-title">Thank you for joining Kare Yoga</h2>
          <p id="success-body">
            Your email has been received. We’ll contact you with more details about the upcoming
            online session.
          </p>
        </div>
      </div>
    </section>
  </main>

  <script>
    // ====== CONFIG ======
    const SCRIPT_URL =
 "https://script.google.com/macros/s/AKfycbwnkQOgXH7c8A5J-3waQGEE-viwqyTtUqY9gRRKXx3kw4SnwFp-qP43UgA77oQipSNe/exec"; // Apps Script 部署地址（Google 表格）

    const CONDITIONS = ["L_Warm", "L_Cold", "A_Warm", "A_Cold"];

    // 新文案：Assessment & Locomotion
    const COPY = {
      A_Warm: {
        theme: "assessment",
        heroDesktop: "warm.png",
        heroMobile: "product_warm.jpg",
        heroColor: "var(--warm-primary)",
        buttonColor: "var(--warm-button)",
        buttonShadow: "var(--warm-button-shadow)",
        successHeroColor: "var(--warm-primary)",
        headline: "Find Your Best Fit — Meditation Yoga Online with Kare Yoga",
        lead:
          "Before beginning any practice, it is important to carefully consider which approach aligns most accurately with your needs. Our Meditation Yoga program helps you evaluate different methods and identify the option that best suits you—supported by experienced instructors who offer clear guidance and thoughtful, reflective feedback.",
        bullets: [
          "Clear instructions to evaluate each posture accurately",
          "Mindful attention to breathing, alignment, and sensations",
          "Personalized feedback to refine your technique",
          "Flexible schedules to compare and choose options",
        ],
        closing1:
          "We are currently in the process of developing this online meditation yoga course. If you would like to assess the details of this course and are interested in receiving updates, you may voluntarily provide your email address.",
        closing2:
          "Your contact information will be used solely for course-related updates, and you may withdraw your interest at any time.",
        buttonText: "Learn More",
      },
      A_Cold: {
        theme: "assessment",
        heroDesktop: "cold.png",
        heroMobile: "product_cold.jpg",
        heroColor: "var(--cold-primary)",
        buttonColor: "var(--cold-button)",
        buttonShadow: "var(--cold-button-shadow)",
        successHeroColor: "var(--cold-primary)",
        headline: "Find Your Best Fit — Meditation Yoga Online with Kare Yoga",
        lead:
          "Before beginning any practice, it is important to carefully consider which approach aligns most accurately with your needs. Our Meditation Yoga program helps you evaluate different methods and identify the option that best suits you—supported by experienced instructors who offer clear guidance and thoughtful, reflective feedback.",
        bullets: [
          "Clear instructions to evaluate each posture accurately",
          "Mindful attention to breathing, alignment, and sensations",
          "Personalized feedback to refine your technique",
          "Flexible schedules to compare and choose options",
        ],
        closing1:
          "We are currently in the process of developing this online meditation yoga course. If you would like to assess the details of this course and are interested in receiving updates, you may voluntarily provide your email address.",
        closing2:
          "Your contact information will be used solely for course-related updates, and you may withdraw your interest at any time.",
        buttonText: "Learn More",
      },
      L_Warm: {
        theme: "locomotion",
        heroDesktop: "warm.png",
        heroMobile: "product_warm.jpg",
        heroColor: "var(--warm-primary)",
        buttonColor: "var(--warm-button)",
        buttonShadow: "var(--warm-button-shadow)",
        successHeroColor: "var(--warm-primary)",
        headline: "Start Your Flow Today — Power Yoga Online with Kare Yoga",
        lead:
          "Your journey to greater strength and energy begins now, encouraging you to take action and keep moving forward. Our Power Yoga program helps you build momentum and achieve steady progress with each session—supported by live instructors who keep you active, engaged, and continuously advancing.",
        bullets: [
          "Fast-paced classes that keep you moving continuously",
          "Energizing flows that activate body and mind",
          "Steady gains in stamina, flexibility, and mobility",
          "Progress tools to stay motivated and advancing",
        ],
        closing1:
          "We are currently in the process of developing this online power yoga course. If you are motivated to energize yourself with this course and are interested in receiving updates, you may voluntarily provide your email address.",
        closing2:
          "Your contact information will be used solely for course-related updates, and you may withdraw your interest at any time.",
        buttonText: "Get Started Now",
      },
      L_Cold: {
        theme: "locomotion",
        heroDesktop: "cold.png",
        heroMobile: "product_cold.jpg",
        heroColor: "var(--cold-primary)",
        buttonColor: "var(--cold-button)",
        buttonShadow: "var(--cold-button-shadow)",
        successHeroColor: "var(--cold-primary)",
        headline: "Start Your Flow Today — Power Yoga Online with Kare Yoga",
        lead:
          "Your journey to greater strength and energy begins now, encouraging you to take action and keep moving forward. Our Power Yoga program helps you build momentum and achieve steady progress with each session—supported by live instructors who keep you active, engaged, and continuously advancing.",
        bullets: [
          "Fast-paced classes that keep you moving continuously",
          "Energizing flows that activate body and mind",
          "Steady gains in stamina, flexibility, and mobility",
          "Progress tools to stay motivated and advancing",
        ],
        closing1:
          "We are currently in the process of developing this online power yoga course. If you are motivated to energize yourself with this course and are interested in receiving updates, you may voluntarily provide your email address.",
        closing2:
          "Your contact information will be used solely for course-related updates, and you may withdraw your interest at any time.",
        buttonText: "Get Started Now",
      },
    };

    // ====== HELPERS ======

    function getQueryParam(name) {
      const params = new URLSearchParams(window.location.search);
      return params.get(name);
    }

    function randomCondition() {
      const idx = Math.floor(Math.random() * CONDITIONS.length);
      return CONDITIONS[idx];
    }

    function ensureSubjectId() {
      const key = "kareyoga_subject_id";
      let existing = window.localStorage.getItem(key);
      if (!existing) {
        existing =
          Math.random().toString(36).slice(2, 8) +
          Math.random().toString(36).slice(2, 8);
        window.localStorage.setItem(key, existing);
      }
      return existing;
    }

    function getDeviceType() {
      const ua = navigator.userAgent || "";
      if (/mobile/i.test(ua)) return "mobile";
      if (/tablet|ipad/i.test(ua)) return "tablet";
      return "desktop";
    }

    function collectContextPayload() {
      const language =
        (navigator.languages && navigator.languages[0]) ||
        navigator.language ||
        "";
      const timezoneOffset = new Date().getTimezoneOffset(); // minutes
      const screenWidth = window.screen && window.screen.width;
      const screenHeight = window.screen && window.screen.height;
      const viewportWidth = window.innerWidth;
      const viewportHeight = window.innerHeight;
      const devicePixelRatio = window.devicePixelRatio || 1;

      return {
        device_type: getDeviceType(),
        language,
        timezone_offset: timezoneOffset,
        screen_width: screenWidth,
        screen_height: screenHeight,
        viewport_width: viewportWidth,
        viewport_height: viewportHeight,
        device_pixel_ratio: devicePixelRatio,
      };
    }

    function sendEvent(payload) {
      const body = new URLSearchParams(payload);

      if (navigator.sendBeacon) {
        navigator.sendBeacon(SCRIPT_URL, body);
        return Promise.resolve(true);
      }

      return fetch(SCRIPT_URL, {
        method: "POST",
        mode: "no-cors",
        headers: {
          "Content-Type": "application/x-www-form-urlencoded",
        },
        body,
      })
        .then(() => true)
        .catch(() => false);
    }

    // ====== MAIN ======

    document.addEventListener("DOMContentLoaded", () => {
      const hero = document.getElementById("hero");
      const heroDesktop = document.getElementById("hero-desktop");
      const heroMobile = document.getElementById("hero-mobile");

      const headlineEl = document.getElementById("headline");
      const leadEl = document.getElementById("lead");
      const listEl = document.getElementById("benefit-list");
      const closing1El = document.getElementById("closing1");
      const closing2El = document.getElementById("closing2");

      const emailForm = document.getElementById("email-form");
      const emailInput = document.getElementById("email-input");
      const errorText = document.getElementById("error-text");
      const submitBtn = document.getElementById("submit-btn");
      const submitLabel = document.getElementById("submit-label");

      const overlay = document.getElementById("success-overlay");
      const successHero = document.getElementById("success-hero");

      // ---- condition selection ----
      const urlCond = getQueryParam("cond");
      const condition = CONDITIONS.includes(urlCond) ? urlCond : randomCondition();
      const copy = COPY[condition];

      window.__kareyogaCondition = condition;

      // apply theme
      hero.style.background = copy.heroColor;
      heroDesktop.srcset = copy.heroDesktop;
      heroMobile.src = copy.heroMobile;

      successHero.style.background = copy.successHeroColor;
      successHero.style.setProperty(
        "--success-color",
        copy.successHeroColor
      );

      submitBtn.style.background = copy.buttonColor;
      submitBtn.style.boxShadow = copy.buttonShadow;

      // text content
      headlineEl.textContent = copy.headline;
      leadEl.textContent = copy.lead;

      listEl.innerHTML = "";
      copy.bullets.forEach((b) => {
        const li = document.createElement("li");
        li.textContent = b;
        listEl.appendChild(li);
      });

      closing1El.textContent = copy.closing1;
      closing2El.textContent = copy.closing2;
      submitLabel.textContent = copy.buttonText;

      // ---- logging state ----
      const subjectId = ensureSubjectId();
      const sessionStart = Date.now();
      let hasLoggedView = false;
      let hasLoggedSubmit = false;
      let isSubmitting = false;

      function buildPayload(eventType, staySeconds, emailValue) {
        const base = collectContextPayload();
        return {
          timestamp: new Date().toISOString(),
          event_type: eventType,
          email: emailValue || "",
          stay_seconds: staySeconds != null ? String(staySeconds) : "",
          subject_id: subjectId,
          condition: condition,
          user_agent: navigator.userAgent || "",
          referer: document.referrer || "",
          device_type: base.device_type || "",
          language: base.language || "",
          timezone_offset: base.timezone_offset ?? "",
          screen_width: base.screen_width ?? "",
          screen_height: base.screen_height ?? "",
          viewport_width: base.viewport_width ?? "",
          viewport_height: base.viewport_height ?? "",
          device_pixel_ratio: base.device_pixel_ratio ?? "",
        };
      }

      function getStaySeconds() {
        const diffMs = Date.now() - sessionStart;
        return Math.max(0, Math.round(diffMs / 1000));
      }

      function logViewIfNeeded() {
        if (hasLoggedView || hasLoggedSubmit) return;
        hasLoggedView = true;
        const staySeconds = getStaySeconds();
        const payload = buildPayload("view_only", staySeconds, "");
        sendEvent(payload);
      }

      // log when用户离开 or tab 被隐藏
      window.addEventListener("beforeunload", () => {
        logViewIfNeeded();
      });

      document.addEventListener("visibilitychange", () => {
        if (document.visibilityState === "hidden") {
          logViewIfNeeded();
        }
      });

      // ---- form / validation ----
      function validateEmail(value) {
        if (!value) return false;
        const pattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return pattern.test(value);
      }

      emailInput.addEventListener("input", () => {
        errorText.classList.remove("is-visible");
      });

      emailForm.addEventListener("submit", (evt) => {
        evt.preventDefault();
        if (isSubmitting) return;

        const emailValue = emailInput.value.trim();
        if (!validateEmail(emailValue)) {
          errorText.classList.add("is-visible");
          emailInput.focus();
          return;
        }

        errorText.classList.remove("is-visible");
        isSubmitting = true;
        hasLoggedSubmit = true;
        hasLoggedView = true; // 避免再记一条 view_only

        submitBtn.classList.add("is-submitting");

        const staySeconds = getStaySeconds();
        const payload = buildPayload("submit", staySeconds, emailValue);

        sendEvent(payload).finally(() => {
          overlay.classList.add("is-visible");
          overlay.setAttribute("aria-hidden", "false");
          isSubmitting = false;
          submitBtn.classList.remove("is-submitting");
        });
      });
    });
  </script>
</body>
</html>
